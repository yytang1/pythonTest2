diff --git a/libavformat/avidec.c b/libavformat/avidec.c
index 0067ff9..b78a3d2 100644 (file)
--- a/libavformat/avidec.c
+++ b/libavformat/avidec.c
@@ -1125,6 +1125,7 @@ resync:
         err= av_get_packet(pb, pkt, size);
         if(err<0)
             return err;
+        size = err;
 
         if(ast->has_pal && pkt->data && pkt->size<(unsigned)INT_MAX/2){
             uint8_t *pal;
