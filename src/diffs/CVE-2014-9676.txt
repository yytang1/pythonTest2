diff --git a/libavformat/segment.c b/libavformat/segment.c.new

--- a/libavformat/segment.c    2014-11-29 03:34:20.000000000 +0800
+++ b/libavformat/segment.c.new    2014-12-25 10:21:24.257001354 +0800
@@ -713,7 +713,7 @@

    if (ret < 0) {
        if (seg->list)
            avio_close(seg->list_pb);
-        avformat_free_context(oc);
+        avformat_free_context(seg->avf);
    }

    return ret;