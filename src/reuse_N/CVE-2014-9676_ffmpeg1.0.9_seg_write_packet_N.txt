diff的N行：
if (ret < 0) {
if (seg->list)
avio_close(seg->list_pb);
avformat_free_context(oc);
}

return ret;
//**************
        oc->nb_streams = 0;
        if (seg->list)
            avio_close(seg->list_pb);
        avformat_free_context(oc);
    }

    return ret;